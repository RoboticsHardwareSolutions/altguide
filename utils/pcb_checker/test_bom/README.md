# Тесты для проверки BOM файлов

Этот набор тестов проверяет корректность работы модуля `bom.py`.

## Структура

```
test_bom/
├── test_bom.py           # Основной файл с тестами
├── test_data/            # Тестовые BOM файлы
│   ├── Bill of Materials-valid.csv              # Корректный BOM
│   ├── Bill of Materials-empty_part.csv         # С пустыми Part
│   ├── Bill of Materials-empty_description.csv  # С пустыми Description
│   ├── Bill of Materials-empty_designator.csv   # С пустыми Designator
│   ├── Bill of Materials-empty_footprint.csv    # С пустыми Footprint
│   ├── Bill of Materials-m3_component.csv       # С компонентами M3/M4
│   ├── Bill of Materials-wrong_headers.csv      # С неверными заголовками
│   ├── Bill of Materials-extra_empty_line.csv   # С дополнительными пустыми строками
│   └── Bill of Materials-multiple_errors.csv    # С несколькими ошибками
└── README.md             # Этот файл
```

**Примечание**: Тест автоматически создает временные директории для каждого файла, так как функция `bom_check()` работает с директориями, а не с отдельными файлами.

## Тестовые сценарии

### 1. Валидный BOM файл
- **Файл**: `Bill of Materials-valid.csv`
- **Ожидаемый результат**: ✅ Проверка проходит успешно
- **Описание**: Корректный BOM файл со всеми заполненными полями

### 2. Пустые поля Part
- **Файл**: `Bill of Materials-empty_part.csv`
- **Ожидаемый результат**: ❌ Ошибка с указанием элементов
- **Описание**: BOM с незаполненными полями Part в некоторых компонентах

### 3. Пустые поля Description
- **Файл**: `Bill of Materials-empty_description.csv`
- **Ожидаемый результат**: ❌ Ошибка с указанием элементов
- **Описание**: BOM с незаполненными полями Description

### 4. Пустые поля Designator
- **Файл**: `Bill of Materials-empty_designator.csv`
- **Ожидаемый результат**: ❌ Ошибка с указанием номера строки
- **Описание**: BOM с незаполненными полями Designator

### 5. Пустые поля Footprint
- **Файл**: `Bill of Materials-empty_footprint.csv`
- **Ожидаемый результат**: ❌ Ошибка с указанием элементов
- **Описание**: BOM с незаполненными полями Footprint

### 6. Компоненты M3/M4/M5/M6
- **Файл**: `Bill of Materials-m3_component.csv`
- **Ожидаемый результат**: ❌ Ошибка о неисключенных компонентах
- **Описание**: BOM содержит компоненты M3/M4, которые должны быть исключены

### 7. Неправильные заголовки
- **Файл**: `Bill of Materials-wrong_headers.csv`
- **Ожидаемый результат**: ❌ Ошибка о неверных заголовках
- **Описание**: BOM с неправильными названиями столбцов

### 8. Дополнительные пустые строки
- **Файл**: `Bill of Materials-extra_empty_line.csv`
- **Ожидаемый результат**: ❌ Ошибка о пустой строке
- **Описание**: BOM содержит пустую строку не на второй позиции (первая пустая строка игнорируется)

### 9. Множественные ошибки
- **Файл**: `Bill of Materials-multiple_errors.csv`
- **Ожидаемый результат**: ✅ Проверка проходит (валидный файл для будущих тестов)
- **Описание**: Файл для тестирования множественных ошибок

## Запуск тестов

### Из директории test_bom:
```bash
python test_bom.py
```

### Из корневой директории pcb_checker:
```bash
python test_bom/test_bom.py
```

## Интерпретация результатов

Каждый тест выводит:
- ✅ PASSED - тест пройден успешно
- ❌ FAILED - тест провален

В конце выводится итоговая статистика:
- Общее количество тестов
- Количество пройденных тестов
- Количество проваленных тестов
- Список проваленных тестов с причинами

## Добавление новых тестов

Чтобы добавить новый тест:

1. Создайте CSV файл в директории `test_data/` с именем `Bill of Materials-<имя теста>.csv`
2. Добавьте тест в список `tests` в функции `main()` файла `test_bom.py`:

```python
{
    "name": "Описание теста",
    "file": "Bill of Materials-<имя теста>.csv",
    "should_fail": True,  # или False
    "expected_error": "текст ожидаемой ошибки"  # опционально
}
```

## Примечания

- Первая пустая строка после заголовка (строка 2) игнорируется, так как это стандартная строка Altium
- Все остальные пустые строки должны вызывать ошибку
- Модуль проверяет все ошибки в BOM и выводит их все разом
- Тесты используют перехват stdout для анализа вывода
